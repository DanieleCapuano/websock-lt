!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["websock-lt"]=t():e["websock-lt"]=t()}(self,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{send_ws_msg:()=>n,start_ws:()=>o});const o=function(e){e=e||{};let{port:t,callback:o,preserve_last_message:n}=e;return t=t||"6789",c.preserve_last_message=n,new Promise((e=>{try{a(t,o,e)}catch(t){e()}}))},n=d;let s=null,r=null,l=null;const c=window.CONFIG||{};function a(e,t,o){console.info("Connecting to websocket..."),s=new WebSocket("ws://localhost:"+e),s.addEventListener("open",(function(){console.info("WebSocket Client Connected");const e=e=>{t&&t(JSON.parse(e))};l&&function(e){const t=c.preserve_last_message,o=t=>{e&&e(t),d(t)};t.id?Object.keys(l).forEach((e=>o(l[e]))):o(l)}(e),s.addEventListener("message",(function(t){let o=t.utf8Data||t.data;c._DEBUG_&&console.log("Received: '"+o+"'"),c.preserve_last_message&&f(o),e(o)})),o&&o(s)})),s.addEventListener("error",(function(e){c._DEBUG_&&console.log("Connection Error: "+e.toString()),s=null,o&&o()})),s.addEventListener("close",(function(){console.warn("Websocket Connection Closed"),s=null,r||(r=setInterval((()=>{if(s)return clearInterval(r),void(r=null);a(e,t,o)}),3e3))}))}let i=!1;function d(e){if(!(s||{}).readyState)return i||console.warn("No WS Connection available: No color sent"),void(i=!0);let t=JSON.stringify(e);c._DEBUG_&&console.info("MSG",t),c.preserve_last_message&&f(e),s.send(t)}function f(e){if(c.preserve_last_message){let t=c.preserve_last_message;t.id?(l=l||{},l[e[t.id]]=(t.transform_msg||(e=>e))(e)):l=e}}return t})()));