!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports["websock-lt"]=n():e["websock-lt"]=n()}(self,(()=>(()=>{"use strict";var e={d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};e.r(n),e.d(n,{send_ws_msg:()=>o,set_default_connection:()=>s,start_ws:()=>t});const t=function(e){e=e||{};let{port:n,callback:t,preserve_last_message:o}=e;return n=n||"6789",i.preserve_last_message=o,new Promise((e=>{try{d(n,t,e)}catch(n){e()}}))},o=u,s=function(e){l=e};let r={},l=null,c=null,a=null;const i=window.CONFIG||{};function d(e,n,t,o){console.info("Connecting to websocket...");let s=new WebSocket("ws://localhost:"+e),l=o||(new Date).getTime();r[l]=s,s.addEventListener("open",(function(){console.info("WebSocket Client Connected to port "+e);const o=e=>{n&&n(JSON.parse(e))};a&&function(e){const n=i.preserve_last_message,t=n=>{e&&e(n.msg,n.conn),u(n.msg,n.conn)};n.id?Object.keys(a).forEach((e=>t(a[e]))):t(a)}(o),s.addEventListener("message",(function(e){let n=e.utf8Data||e.data;i._DEBUG_&&console.log("Received: '"+n+"'"),i.preserve_last_message&&_(n,s),o(n)})),t&&t(s)})),s.addEventListener("error",(function(e){i._DEBUG_&&console.log("Connection Error: "+e.toString()),s=null,r[l]=null,t&&t()})),s.addEventListener("close",(function(){console.warn("Websocket Connection Closed"),s=null,r[l]=null,(c||{})[l]||(c=c||{},c[l]=setInterval((()=>{if(r[l])return clearInterval(c[l]),void(c[l]=null);d(e,n,t,l)}),3e3))}))}let f=!1;function u(e,n){let t=Object.keys(r),o=n||l||r[t[0]]||{send:()=>"fake_connection"};if(!o.readyState)return f||console.warn("No WS Connection available: No Message sent"),void(f=!0);let s=JSON.stringify(e);o.send(s),i._DEBUG_&&console.info("MSG",s),i.preserve_last_message&&_(e,o)}function _(e,n){if(i.preserve_last_message){let t=i.preserve_last_message;t.id?(a=a||{},a[e[t.id]]={conn:n,msg:(t.transform_msg||(e=>e))(e)}):a={conn:n,msg:e}}}return n})()));