!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["websock-lt"]=t():e["websock-lt"]=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{send_ws_msg:()=>o,start_ws:()=>n});const n=function(e){e=e||{};let{port:t,callback:n,preserve_last_message:o}=e;return t=t||"6789",c.preserve_last_message=o,new Promise((e=>{try{a(t,n,e)}catch(t){e()}}))},o=d;let s={},r=null,l=null;const c=window.CONFIG||{};function a(e,t,n,o){console.info("Connecting to websocket...");let i=new WebSocket("ws://localhost:"+e),u=o||(new Date).getTime();s[u]=i,i.addEventListener("open",(function(){console.info("WebSocket Client Connected to port "+e);const o=e=>{t&&t(JSON.parse(e))};l&&function(e){const t=c.preserve_last_message,n=t=>{e&&e(t.msg,t.conn),d(t.msg,t.conn)};t.id?Object.keys(l).forEach((e=>n(l[e]))):n(l)}(o),i.addEventListener("message",(function(e){let t=e.utf8Data||e.data;c._DEBUG_&&console.log("Received: '"+t+"'"),c.preserve_last_message&&f(t,i),o(t)})),n&&n(i)})),i.addEventListener("error",(function(e){c._DEBUG_&&console.log("Connection Error: "+e.toString()),i=null,s[u]=null,n&&n()})),i.addEventListener("close",(function(){console.warn("Websocket Connection Closed"),i=null,s[u]=null,(r||{})[u]||(r=r||{},r[u]=setInterval((()=>{if(s[u])return clearInterval(r[u]),void(r[u]=null);a(e,t,n,u)}),3e3))}))}let i=!1;function d(e,t){let n=Object.keys(s);if(!(t||s[n[0]]||{}).readyState)return i||console.warn("No WS Connection available: No Message sent"),void(i=!0);let o=JSON.stringify(e);c._DEBUG_&&console.info("MSG",o),c.preserve_last_message&&f(e,t),(t||s[n[0]]).send(o)}function f(e,t){if(c.preserve_last_message){let n=c.preserve_last_message;n.id?(l=l||{},l[e[n.id]]={conn:t,msg:(n.transform_msg||(e=>e))(e)}):l={conn:t,msg:e}}}return t})()));