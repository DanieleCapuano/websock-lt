!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["websock-lt"]=t():e["websock-lt"]=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{send_ws_msg:()=>o,set_default_connection:()=>s,start_ws:()=>n});const n=function(e){e=e||{};let{port:t,callback:n,preserve_last_message:o}=e;return t=t||"6789",i.preserve_last_message=o,new Promise((e=>{try{d(t,n,e)}catch(t){e()}}))},o=u,s=function(e){l=e};let r={},l=null,c=null,a=null;const i=window.CONFIG||{};function d(e,t,n,o){console.info("Connecting to websocket...");let s=new WebSocket("ws://localhost:"+e),l=o||(new Date).getTime();r[l]=s,s.addEventListener("open",(function(){console.info("WebSocket Client Connected to port "+e);const o=e=>{t&&t(JSON.parse(e))};a&&function(e){const t=i.preserve_last_message,n=t=>{e&&e(t.msg,t.conn),u(t.msg,t.conn)};t.id?Object.keys(a).forEach((e=>n(a[e]))):n(a)}(o),s.addEventListener("message",(function(e){let t=e.utf8Data||e.data;i._DEBUG_&&console.log("Received: '"+t+"'"),i.preserve_last_message&&_(t,s),o(t)})),n&&n(s)})),s.addEventListener("error",(function(e){i._DEBUG_&&console.log("Connection Error: "+e.toString()),s=null,r[l]=null,n&&n()})),s.addEventListener("close",(function(){console.warn("Websocket Connection Closed"),s=null,r[l]=null,(c||{})[l]||(c=c||{},c[l]=setInterval((()=>{if(r[l])return clearInterval(c[l]),void(c[l]=null);d(e,t,n,l)}),3e3))}))}let f=!1;function u(e,t){let n=Object.keys(r);if(!(t||l||r[n[0]]||{}).readyState)return f||console.warn("No WS Connection available: No Message sent"),void(f=!0);let o=JSON.stringify(e);i._DEBUG_&&console.info("MSG",o),i.preserve_last_message&&_(e,t),(t||r[n[0]]).send(o)}function _(e,t){if(i.preserve_last_message){let n=i.preserve_last_message;n.id?(a=a||{},a[e[n.id]]={conn:t,msg:(n.transform_msg||(e=>e))(e)}):a={conn:t,msg:e}}}return t})()));